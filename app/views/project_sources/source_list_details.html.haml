%div{'ng-app'=>'MappingEditorApp', 'ng-init'=> init_scope(project_id: @project.id, source_list_id: @source.id, source_property: @source.mapping_property.try(:id), source_field_options: @source.as_collection.fields.map{|f| {name: f.name, id: f.id}}.select{|h| !h[:name].starts_with?("_")}, mapping_hash: @source.mapping, hierarchy: @hierarchy)}
  - angular_templates 'shared/angular'

  %div{'ng-controller' => 'MappingEditorCtrl'}
    = back_to_project
    %h1
      = @source.name

    %h2 Facilities classification

    {{(percentage_classified | number) || 0}}%
    classified
    .progress
      .bar{style: "width: {{percentage_classified}}%"}

    %p Facilities in source lists need to be classified into the geo-political division.

    %p
      Classify by:
      %select{'ng-model' => 'mapping_property', 'ng-options' => 'f.name for f in fields'}

    = render 'mapping_editor'

    %h2 Facilities curation

    = "#{@curation_progress || "0%"} curated"
    .progress
      .bar{style: "width: #{@curation_progress}"}

    = link_to unmapped_csv_download_project_source_path(@project, @source), class: "btn btn-success btn-large" do
      %i.icon-white.icon-download-alt
      Export not curated data

    = link_to '#', class: "btn btn-success btn-large disabled" do
      %i.icon-white.icon-upload
      Upload new version
